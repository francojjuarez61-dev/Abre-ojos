<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora Moderna</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      color-scheme: dark;
      --bg: #0b0f1a;
      --panel: rgba(17, 23, 39, 0.92);
      --panel-soft: rgba(255, 255, 255, 0.08);
      --accent: #7c5cff;
      --accent-strong: #9d7bff;
      --text: #f4f6ff;
      --muted: #9aa4c7;
      --danger: #ff6b6b;
      --success: #43d9a3;
      --shadow: 0 28px 60px rgba(8, 10, 24, 0.65);
      --radius: 24px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', system-ui, sans-serif;
    }

    body {
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: radial-gradient(circle at top, #1b2040 0%, var(--bg) 60%);
      color: var(--text);
      padding: 24px;
    }

    .calculator {
      width: min(430px, 100%);
      background: var(--panel);
      border-radius: var(--radius);
      padding: 28px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .calculator::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(124, 92, 255, 0.45), transparent 55%);
      opacity: 0.85;
      pointer-events: none;
    }

    .calculator-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      position: relative;
      z-index: 1;
    }

    .calculator-header h1 {
      font-size: 1.35rem;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .calculator-header span {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .badge {
      background: rgba(124, 92, 255, 0.2);
      color: var(--accent-strong);
      padding: 6px 12px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.75rem;
    }

    .display {
      background: var(--panel-soft);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: relative;
      z-index: 1;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(8px);
    }

    .display .history {
      font-size: 0.95rem;
      color: var(--muted);
      min-height: 22px;
      text-align: right;
      word-break: break-word;
    }

    .display .result {
      font-size: clamp(2rem, 5vw, 2.8rem);
      font-weight: 700;
      text-align: right;
      word-break: break-word;
    }

    .meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      font-size: 0.85rem;
      color: var(--muted);
      position: relative;
      z-index: 1;
    }

    .meta .pill {
      background: rgba(67, 217, 163, 0.18);
      color: var(--success);
      padding: 6px 12px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.75rem;
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      position: relative;
      z-index: 1;
    }

    button {
      border: none;
      border-radius: 16px;
      padding: 16px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.08);
      color: var(--text);
      transition: transform 0.15s ease, background 0.2s ease, box-shadow 0.2s ease;
    }

    button:hover {
      transform: translateY(-1px);
      background: rgba(255, 255, 255, 0.14);
    }

    button:active {
      transform: scale(0.98);
    }

    .button-accent {
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: #fff;
      box-shadow: 0 12px 24px rgba(124, 92, 255, 0.35);
    }

    .button-accent:hover {
      background: linear-gradient(135deg, #6c4dff, #ae8dff);
    }

    .button-danger {
      background: rgba(255, 107, 107, 0.18);
      color: var(--danger);
    }

    .button-success {
      background: rgba(67, 217, 163, 0.2);
      color: var(--success);
    }

    .button-wide {
      grid-column: span 2;
    }

    .footer {
      margin-top: 20px;
      font-size: 0.75rem;
      color: var(--muted);
      text-align: center;
      position: relative;
      z-index: 1;
    }
  </style>
</head>
<body>
  <main class="calculator" aria-label="Calculadora moderna">
    <header class="calculator-header">
      <div>
        <h1>Calculadora Moderna</h1>
        <span>Precisa, rápida y minimalista</span>
      </div>
      <span class="badge">v1.1</span>
    </header>

    <section class="display" aria-live="polite">
      <div class="history" id="history"></div>
      <div class="result" id="result">0</div>
    </section>

    <div class="meta">
      <span>Modo científico ligero</span>
      <span class="pill" id="memory">MEM 0</span>
    </div>

    <section class="buttons" role="group" aria-label="Teclado de la calculadora">
      <button class="button-danger" data-action="clear">C</button>
      <button class="button-danger" data-action="delete">⌫</button>
      <button data-action="percent">%</button>
      <button data-action="operator" data-value="/">÷</button>

      <button data-action="number" data-value="7">7</button>
      <button data-action="number" data-value="8">8</button>
      <button data-action="number" data-value="9">9</button>
      <button data-action="operator" data-value="*">×</button>

      <button data-action="number" data-value="4">4</button>
      <button data-action="number" data-value="5">5</button>
      <button data-action="number" data-value="6">6</button>
      <button data-action="operator" data-value="-">−</button>

      <button data-action="number" data-value="1">1</button>
      <button data-action="number" data-value="2">2</button>
      <button data-action="number" data-value="3">3</button>
      <button data-action="operator" data-value="+">+</button>

      <button class="button-success" data-action="memory">M+</button>
      <button data-action="number" data-value="0">0</button>
      <button data-action="decimal">.</button>
      <button class="button-accent" data-action="equals">=</button>

      <button class="button-wide" data-action="sqrt">√x</button>
      <button class="button-wide" data-action="square">x²</button>
    </section>

    <p class="footer">Tip: también puedes usar el teclado numérico.</p>
  </main>

  <script>
    const historyEl = document.getElementById('history');
    const resultEl = document.getElementById('result');
    const memoryEl = document.getElementById('memory');

    let current = '0';
    let previous = null;
    let operator = null;
    let awaitingNext = false;
    let memory = 0;

    const formatDisplay = (value) => {
      if (value === '-') return value;
      const [integer, decimal] = value.split('.');
      const formattedInt = Number(integer).toLocaleString('es-ES');
      return decimal ? `${formattedInt}.${decimal}` : formattedInt;
    };

    const updateDisplay = () => {
      resultEl.textContent = formatDisplay(current);
      historyEl.textContent = previous && operator ? `${formatDisplay(previous)} ${operator}` : '';
      memoryEl.textContent = `MEM ${memory}`;
    };

    const setCurrent = (value) => {
      current = value;
      updateDisplay();
    };

    const appendNumber = (value) => {
      if (awaitingNext) {
        current = value;
        awaitingNext = false;
      } else if (current === '0') {
        current = value;
      } else {
        current += value;
      }
      updateDisplay();
    };

    const appendDecimal = () => {
      if (awaitingNext) {
        current = '0.';
        awaitingNext = false;
        updateDisplay();
        return;
      }
      if (!current.includes('.')) {
        current += '.';
        updateDisplay();
      }
    };

    const setOperator = (value) => {
      if (operator && !awaitingNext) {
        compute();
      }
      previous = current;
      operator = value;
      awaitingNext = true;
      updateDisplay();
    };

    const compute = () => {
      if (!operator || previous === null) return;
      const prev = parseFloat(previous);
      const curr = parseFloat(current);
      if (Number.isNaN(prev) || Number.isNaN(curr)) return;

      let result = 0;
      switch (operator) {
        case '+':
          result = prev + curr;
          break;
        case '-':
          result = prev - curr;
          break;
        case '*':
          result = prev * curr;
          break;
        case '/':
          result = curr === 0 ? 0 : prev / curr;
          break;
        default:
          return;
      }

      current = `${Number(result.toFixed(10))}`;
      previous = null;
      operator = null;
      awaitingNext = true;
      updateDisplay();
    };

    const clearAll = () => {
      current = '0';
      previous = null;
      operator = null;
      awaitingNext = false;
      updateDisplay();
    };

    const deleteLast = () => {
      if (awaitingNext) {
        current = '0';
        awaitingNext = false;
      } else if (current.length > 1) {
        current = current.slice(0, -1);
      } else {
        current = '0';
      }
      updateDisplay();
    };

    const percent = () => {
      const value = parseFloat(current);
      if (Number.isNaN(value)) return;
      setCurrent(`${value / 100}`);
    };

    const square = () => {
      const value = parseFloat(current);
      if (Number.isNaN(value)) return;
      setCurrent(`${value * value}`);
    };

    const sqrt = () => {
      const value = parseFloat(current);
      if (Number.isNaN(value)) return;
      setCurrent(value < 0 ? '0' : `${Math.sqrt(value)}`);
    };

    const addMemory = () => {
      const value = parseFloat(current);
      if (Number.isNaN(value)) return;
      memory = Number((memory + value).toFixed(2));
      updateDisplay();
    };

    document.querySelectorAll('button[data-action]').forEach((button) => {
      button.addEventListener('click', () => {
        const action = button.dataset.action;
        const value = button.dataset.value;

        switch (action) {
          case 'number':
            appendNumber(value);
            break;
          case 'decimal':
            appendDecimal();
            break;
          case 'operator':
            setOperator(value);
            break;
          case 'equals':
            compute();
            break;
          case 'clear':
            clearAll();
            break;
          case 'delete':
            deleteLast();
            break;
          case 'percent':
            percent();
            break;
          case 'square':
            square();
            break;
          case 'sqrt':
            sqrt();
            break;
          case 'memory':
            addMemory();
            break;
          default:
            break;
        }
      });
    });

    document.addEventListener('keydown', (event) => {
      if (event.key >= '0' && event.key <= '9') {
        appendNumber(event.key);
      }
      if (event.key === '.') {
        appendDecimal();
      }
      if (['+', '-', '*', '/'].includes(event.key)) {
        setOperator(event.key);
      }
      if (event.key === 'Enter' || event.key === '=') {
        event.preventDefault();
        compute();
      }
      if (event.key === 'Backspace') {
        deleteLast();
      }
      if (event.key === 'Escape') {
        clearAll();
      }
    });

    updateDisplay();
  </script>
</body>
</html>
